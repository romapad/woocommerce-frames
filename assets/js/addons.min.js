jQuery(document).ready(function(a){a.fn.init_addon_totals=function(){a(this).on("keyup change",".grmpd-frame input, .grmpd-frame textarea",function(){if(a(this).attr("maxlength")>0){var b=a(this).val(),c=a(this).attr("maxlength")-b.length;a(this).next(".chars_remaining").find("span").text(c)}}),a(this).find(" .addon-custom, .addon-custom-textarea").each(function(){a(this).attr("maxlength")>0&&a(this).after('<small class="chars_remaining"><span>'+a(this).attr("maxlength")+"</span> "+grmpd_frames_params.i18n_remaining+"</small>")}),a(this).on("change",".grmpd-frame input, .grmpd-frame textarea, .grmpd-frame select, input.qty",function(){a(this).trigger("grmpd-frames-update")}),a(this).on("found_variation",function(b,c){var d=a(this),e=d.find("#grmpd-frames-total");"undefined"!=typeof c.display_price?e.data("price",c.display_price):a(c.price_html).find(".amount:last").size()&&(product_price=a(c.price_html).find(".amount:last").text(),product_price=product_price.replace(grmpd_frames_params.currency_format_symbol,""),product_price=product_price.replace(grmpd_frames_params.currency_format_thousand_sep,""),product_price=product_price.replace(grmpd_frames_params.currency_format_decimal_sep,"."),product_price=product_price.replace(/[^0-9\.]/g,""),product_price=parseFloat(product_price),e.data("price",product_price)),d.trigger("grmpd-frames-update")}),a(this).on("grmpd-frames-update",function(){var b=0,c=a(this),d=c.find("#grmpd-frames-total"),e=d.data("price"),f=d.data("type"),g=d.data("product-id"),h=d.data("raw-price"),i=d.data("tax-mode"),j=d.data("tax-display-mode"),k=0;if(("variable"==f||"variable-subscription"==f)&&c.find(".single_variation").after(d),c.find(".addon").each(function(){var c=0,d=0;a(this).is(".addon-custom-price")?c=a(this).val():a(this).is(".addon-input_multiplier")?(isNaN(a(this).val())||""==a(this).val()?(a(this).val(""),a(this).closest("p").find(".addon-alert").show()):(""!=a(this).val()&&a(this).val(Math.ceil(a(this).val())),a(this).closest("p").find(".addon-alert").hide()),c=a(this).data("price")*a(this).val(),d=a(this).data("raw-price")*a(this).val()):a(this).is(".addon-checkbox, .addon-radio")?a(this).is(":checked")&&(c=a(this).data("price"),d=a(this).data("raw-price")):a(this).is(".addon-select")?a(this).val()&&(c=a(this).find("option:selected").data("price"),d=a(this).find("option:selected").data("raw-price")):a(this).val()&&(c=a(this).data("price"),d=a(this).data("raw-price")),c||(c=0),d||(d=0),b=parseFloat(b)+parseFloat(c),k=parseFloat(k)+parseFloat(d)}),c.find("input.qty").size())var l=parseFloat(c.find("input.qty").val());else var l=1;if(b>0&&l>0){b=parseFloat(b*l);var m=accounting.formatMoney(b,{symbol:grmpd_frames_params.currency_format_symbol,decimal:grmpd_frames_params.currency_format_decimal_sep,thousand:grmpd_frames_params.currency_format_thousand_sep,precision:grmpd_frames_params.currency_format_num_decimals,format:grmpd_frames_params.currency_format});if(e){product_total_price=parseFloat(e*l);var n=accounting.formatMoney(product_total_price+b,{symbol:grmpd_frames_params.currency_format_symbol,decimal:grmpd_frames_params.currency_format_decimal_sep,thousand:grmpd_frames_params.currency_format_thousand_sep,precision:grmpd_frames_params.currency_format_num_decimals,format:grmpd_frames_params.currency_format})}var o=accounting.formatMoney(k+h,{symbol:grmpd_frames_params.currency_format_symbol,decimal:grmpd_frames_params.currency_format_decimal_sep,thousand:grmpd_frames_params.currency_format_thousand_sep,precision:grmpd_frames_params.currency_format_num_decimals,format:grmpd_frames_params.currency_format}),p=!1;a(".single_variation_wrap .subscription-details").length?p=a(".single_variation_wrap .subscription-details").clone().wrap("<p>").parent().html():a(".product-type-subscription .subscription-details").length&&(p=a(".product-type-subscription .subscription-details").clone().wrap("<p>").parent().html()),p&&(m+=p,n&&(n+=p));var q='<dl class="grmpd-frame-totals"><dt>'+grmpd_frames_params.i18n_addon_total+'</dt><dd><strong><span class="amount">'+m+"</span></strong></dd>";if(n&&"1"==d.data("show-grand-total")){var r="";if(!grmpd_frames_params.price_display_suffix)return q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span></strong></dd></dl>",d.html(q),void a("body").trigger("updated_addons");if(!1==grmpd_frames_params.price_display_suffix.indexOf("{price_including_tax}")>-1&&!1==grmpd_frames_params.price_display_suffix.indexOf("{price_excluding_tax}")>-1)return q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span> "+grmpd_frames_params.price_display_suffix+"</strong></dd></dl>",d.html(q),void a("body").trigger("updated_addons");if("excl"===i&&"incl"===j)return r='<small class="woocommerce-price-suffix">'+grmpd_frames_params.price_display_suffix+"</small>",r=r.replace("{price_including_tax}",n),r=r.replace("{price_excluding_tax}",o),q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span> "+r+" </strong></dd></dl>",d.html(q),void a("body").trigger("updated_addons");if("incl"===i&&"excl"===j)return r='<small class="woocommerce-price-suffix">'+grmpd_frames_params.price_display_suffix+"</small>",r=r.replace("{price_including_tax}",o),r=r.replace("{price_excluding_tax}",n),q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span> "+r+" </strong></dd></dl>",d.html(q),void a("body").trigger("updated_addons");a.ajax({type:"POST",url:grmpd_frames_params.ajax_url,data:{action:"wc_frames_calculate_tax",total:product_total_price+b,product_id:g},success:function(b){if(result=a.parseJSON(b),"SUCCESS"==result.result){r='<small class="woocommerce-price-suffix">'+grmpd_frames_params.price_display_suffix+"</small>";var c=accounting.formatMoney(result.price_including_tax,{symbol:grmpd_frames_params.currency_format_symbol,decimal:grmpd_frames_params.currency_format_decimal_sep,thousand:grmpd_frames_params.currency_format_thousand_sep,precision:grmpd_frames_params.currency_format_num_decimals,format:grmpd_frames_params.currency_format}),e=accounting.formatMoney(result.price_excluding_tax,{symbol:grmpd_frames_params.currency_format_symbol,decimal:grmpd_frames_params.currency_format_decimal_sep,thousand:grmpd_frames_params.currency_format_thousand_sep,precision:grmpd_frames_params.currency_format_num_decimals,format:grmpd_frames_params.currency_format});r=r.replace("{price_including_tax}",c),r=r.replace("{price_excluding_tax}",e),q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span> "+r+" </strong></dd></dl>",d.html(q),a("body").trigger("updated_addons")}else console.log(result),q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span></strong></dd></dl>",d.html(q),a("body").trigger("updated_addons")},error:function(){q=q+"<dt>"+grmpd_frames_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+n+"</span></strong></dd></dl>",d.html(q),a("body").trigger("updated_addons")}})}}else d.empty()}),a(this).find(".addon-custom, .addon-custom-textarea, .grmpd-frame input, .grmpd-frame textarea, .grmpd-frame select, input.qty").change(),a(this).find(".variations select").change()},a("body").on("quick-view-displayed",function(){a(this).find(".cart:not(.cart_group)").each(function(){a(this).init_addon_totals()})}),a("body .component").on("wc-composite-component-loaded",function(){a(this).find(".cart").each(function(){a(this).init_addon_totals()})}),a("body").find(".cart:not(.cart_group)").each(function(){a(this).init_addon_totals()})});